<html>
  <head>
    <title>Hello, Korea!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/earlyaccess/hanna.css">
    <script type="text/javascript" src="underscore.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
    <script type="text/javascript" src="http://j96.me:8888/faye/client.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      $(function() {
        try
        {
          $.getJSON('http://j96.me:8888',function(json) {
            json = _.sortBy(json, function(item) { return item.time });
            
            for(i in json)
              addRow(json[i]);  
            
          });

          var client = new Faye.Client('http://j96.me:8888/faye');
          var xcoin_sub = client.subscribe('/xcoin', function(json){
            addRow(json.trade);
          });
          var korbit_sub = client.subscribe('/korbit', function(json){
            addRow(json.trade);
          });
        }
        catch(e)
        {
          log(e);
        }
      });
      
      function addRow(json) {
        $('#history tbody').prepend(makeRow(json));  
      }
      
      function makeRow(json) {
        
        return '<tr id="' + json.site + '"><td id="time">' + json.time + '</td>' +
          '<td id="price">' + numeral(json.price).format('0,0') + '(' + json.site.slice(0,1).toUpperCase() + ')</td>' +
          '<td id="bitstamp">' + json.bitstamp + '</td>' +
          '<td id="volume">' + numeral(json.last_qty).format('0[.]00') + '</td>';
      }
      function log(str) {
        //$('#log').val(str + '\n' + $('#log').val());
      };
    </script>
    <style>
      body {
        font-family: 'Nanum Gothic', Monospace;
        background-color: black;
        color: white;
        margin: 0px;
        padding: 0px;
      }
      table {
        margin: 0px;
        padding: 0px;
        width: 100%;
      }
      table td {
        border: 0px solid black;
        text-align: center;
      }
      table #time {
        width: 20%;
      }
      table #price {
        width: 40%;
      }
      table #bitstamp {
        width: 20%;
      }
      table #volume {
/*        padding-left: 20px;*/
        text-align: left;
      }
      #xcoin #price{
        background-color: red;
      }
      #korbit #price{
        background-color: green;
      }
    </style>
  </head>
  <body>
    <table id="history">
      <thead>
        <tr>
          <td>Time</td>
          <td>Last Price</td>
          <td>Bitstamp</td>
          <td id="volume">Qty</td>
        </tr>
      </thead>
      <tbody>
        <tr id="list">
        </tr>
      </tbody>

    </table>
    <!--<textarea id="log" style="width:700;height:300;"></textarea>-->
  </body>
</html>