var max_price=0;var min_price=99999999;var bitstamp_max_price=0;var bitstamp_min_price=99999999;var last_alive_tick=new Date().getTime();$(function(){setInterval(function(){if(last_alive_tick+60*1000<new Date().getTime()){window.location.reload()}last_alive_tick=new Date().getTime()},2*1000);addToHomescreen({startDelay:60,skipFirstVisit:true,maxDisplayCount:5,lifespan:0,icon:false});$.getJSON("http://j96.me:8888",function(b){$("#min_max tbody tr:last").append('<td id="min">'+b.min+'</td><td id="max">'+b.max+"</td>");var d=b.history;for(i in d){addRow(d[i],false)}var c=_.last(d);document.title=numeral(c.price).format("0,0")+"("+c.bitstamp+")"});var a=new Faye.Client("http://j96.me:8888/faye");a.subscribe("/trade",function(b){addRow(b.trade,true);add_to_chart(add_new_data({t:parseInt(b.trade.time),p:parseFloat(b.trade.price),v:parseFloat(b.trade.last_qty)}));document.title=numeral(b.trade.price).format("0,0")+"("+b.trade.bitstamp+")"});a.subscribe("/min",function(b){$("#min").text(b.price)});a.subscribe("/max",function(b){$("#max").text(b.price)})});function addRow(a,b){$("#history tbody").prepend(makeRow(a));if(b){flash($("#history tbody tr:first"),"green")}$("meta[name=description]").remove();$('meta[property="og:description"]').remove();$("head").append('<meta name="description" content="최근 국내에서 거래된 비트코인 가격과 실시간 차트를 볼 수 있습니다. 최종가격 : '+numeral(a.price).format("0,0")+"("+a.site.toUpperCase()+"), Bitstamp : "+a.bitstamp+'" >');$("head").append('<meta property="og:description" content="최근 국내에서 거래된 비트코인 가격과 실시간 차트를 볼 수 있습니다. 최종가격 : '+numeral(a.price).format("0,0")+"("+a.site.toUpperCase()+"), Bitstamp : "+a.bitstamp+'" >')}function makeRow(c){var d=false;var f=false;var a=false;var b=false;var e=false;if(max_price<parseInt(c.price)){d=true;max_price=parseInt(c.price)}if(min_price>parseInt(c.price)){f=true;min_price=parseInt(c.price)}if(parseInt(c.last_qty)>=10){a=true}if(bitstamp_max_price<parseFloat(c.bitstamp)){b=true;bitstamp_max_price=parseFloat(c.bitstamp)}if(bitstamp_min_price>parseFloat(c.bitstamp)){e=true;bitstamp_min_price=parseFloat(c.bitstamp)}return'<tr id="'+c.site+'"><td id="time">'+moment.unix(c.time).format("HH:mm")+'</td><td id="price">'+numeral(c.price).format("0,0")+' <abbr title="'+c.site.toUpperCase()+'">('+c.site.slice(0,1).toUpperCase()+")</abbr>"+(d?'<span class="max">↑</span>':(f?'<span class="min">↓</span>':""))+'</td><td id="bitstamp" class="'+(b?"max":(e?"min":""))+'">'+depth_style(c.bitstamp,2)+" "+(b?"↑":(e?"↓":""))+'</td><td id="volume" class="'+(a?"large_amount":"")+'">'+depth_style(c.last_qty,2)+"</td>"}zero=["","0","00","000","0000"];function depth_style(a,f){var c=parseFloat(a).toFixed(f);for(var e=c.length,b=1;b<f;){if(c.charAt(e-b)=="0"){b++}else{if(b==1){return c}break}}return c.slice(0,e-b+1)+'<span class="zero">'+zero[b-1]+"</span>"}function flash(a,b){if(b==""){return}$(a).addClass(b);setTimeout(function(){$(a).removeClass(b)},1000)};